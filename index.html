<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Travel Itinerary Planner - Interactive Map</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap');
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
body{background:#121212;color:#fff;min-height:100vh;display:flex;justify-content:center;align-items:flex-start;padding:20px;}
.login-container,.planner-container{border-radius:12px;box-shadow:0 8px 20px rgba(0,0,0,0.5);background:#1e1e1e;padding:30px;width:95%;max-width:900px;}
.login-container h2,.planner-container h1{text-align:center;margin-bottom:20px;}
.input-group{margin-bottom:15px;}
.input-group label{display:block;margin-bottom:6px;color:#ccc;}
.input-group input{width:100%;padding:10px;border-radius:6px;border:1px solid #444;background:#121212;color:#fff;}
.input-group input:focus{outline:none;border-color:#fff;}
.btn{width:100%;padding:10px;border:none;border-radius:6px;background:#fff;color:#000;font-weight:500;cursor:pointer;}
.btn:hover{background:#ccc;}
.bottom-text{text-align:center;font-size:14px;margin-top:15px;color:#aaa;}
.trip-form{display:grid;grid-template-columns:1fr 1fr 1fr 1fr auto;gap:10px;align-items:center;margin-bottom:20px;}
input,select{padding:10px;border-radius:6px;border:1px solid #444;background:#121212;color:#fff;}
button{padding:10px 12px;border:none;border-radius:6px;cursor:pointer;transition:0.3s;}
button:hover{opacity:0.9;}
.trip-list{margin-top:20px;}
.trip-card{background:#2a2a2a;border-left:4px solid #fff;border-radius:8px;padding:12px;margin-bottom:12px;display:flex;justify-content:space-between;align-items:center;}
.trip-info h3{margin-bottom:6px;}
.trip-actions button{margin-left:6px;background:#444;color:#fff;}
.trip-actions button.delete{background:#ff4b4b;}
.trip-actions button.map{background:#4CAF50;}
.summary{margin-top:20px;text-align:center;padding:12px;background:#2a2a2a;border-radius:8px;}
#map{height:400px;border-radius:8px;margin-top:15px;border:1px solid #444;}
@media(max-width:768px){.trip-form{grid-template-columns:1fr 1fr;}}
</style>
</head>
<body>

<!-- LOGIN PAGE -->
<div class="login-container" id="loginPage">
<h2>Login</h2>
<div class="input-group"><label>Username</label><input type="text" id="username" placeholder="Enter username"></div>
<div class="input-group"><label>Password</label><input type="password" id="password" placeholder="Enter password"></div>
<button class="btn" onclick="login()">Login</button>
<div class="bottom-text">Offline Demo Planner</div>
</div>

<!-- PLANNER PAGE -->
<div class="planner-container" id="plannerPage">
<h1>üåç Travel Itinerary Planner</h1>

<div class="trip-form">
<input type="text" id="destination" placeholder="Destination">
<input type="date" id="startDate">
<input type="date" id="endDate">
<select id="transport">
<option value="">Transport</option>
<option>Flight</option>
<option>Train</option>
<option>Car</option>
<option>Bus</option>
</select>
<button onclick="addTrip()">Add</button>
</div>

<div class="trip-list" id="tripList"></div>
<div class="summary" id="tripSummary"><h3>Total Destinations: 0</h3><p>Plan your trip and share it with friends via code!</p></div>

<div id="map"></div>

<button onclick="saveTrips()" style="margin-top:10px;">üíæ Save Itinerary</button>
<button onclick="logout()" style="margin-top:10px;">üö™ Logout</button>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// --- LOGIN ---
function login(){
  const user=document.getElementById('username').value.trim();
  const pass=document.getElementById('password').value.trim();
  if(!user||!pass){alert("Enter both fields!"); return;}
  document.getElementById('loginPage').style.display='none';
  document.getElementById('plannerPage').style.display='block';
  initMap();
}

// --- LOGOUT ---
function logout(){
  document.getElementById('plannerPage').style.display='none';
  document.getElementById('loginPage').style.display='block';
}

// --- PLANNER ---
let trips = JSON.parse(localStorage.getItem('trips'))||[];
let map, markers=[], routeLine;

function renderTrips(){
  const list=document.getElementById('tripList');
  const summary=document.getElementById('tripSummary');
  list.innerHTML=''; 
  markers.forEach(m=>map.removeLayer(m)); markers=[];
  if(routeLine){map.removeLayer(routeLine); routeLine=null;}
  summary.innerHTML=`<h3>Total Destinations: ${trips.length}</h3>`;
  
  trips.forEach((trip,index)=>{
    const card=document.createElement('div'); card.className='trip-card';
    const shareCode = generateCode(trip);
    card.innerHTML=`
      <div class="trip-info">
        <h3>${trip.destination}</h3>
        <p>From: ${trip.startDate} | To: ${trip.endDate}</p>
        <p>Transport: ${trip.transport}</p>
        <p>Share Code: <b>${shareCode}</b></p>
      </div>
      <div class="trip-actions">
        <button onclick="editTrip(${index})">‚úèÔ∏è Edit</button>
        <button class="delete" onclick="deleteTrip(${index})">üóëÔ∏è Delete</button>
        <button class="map" onclick="showOnMap(${index})">üó∫Ô∏è Map</button>
      </div>`;
    list.appendChild(card);
  });

  // Draw route and markers
  if(trips.length>0){
    let latlngs=[];
    let promises = trips.map(trip=>fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(trip.destination)}`)
      .then(res=>res.json())
      .then(data=>data.length>0?[parseFloat(data[0].lat),parseFloat(data[0].lon),trip]:null)
    );
    Promise.all(promises).then(results=>{
      results=results.filter(r=>r!=null);
      results.forEach(r=>{
        const marker=L.marker([r[0],r[1]]).addTo(map).bindPopup(`
          <b>${r[2].destination}</b><br>
          ${r[2].startDate} - ${r[2].endDate}<br>
          Transport: ${r[2].transport}<br>
          Share Code: <b>${generateCode(r[2])}</b>
        `);
        markers.push(marker);
      });
      if(results.length>1){
        const routeCoords = results.map(r=>[r[0],r[1]]);
        routeLine=L.polyline(routeCoords,{color:'lime'}).addTo(map);
        map.fitBounds(routeLine.getBounds(),{padding:[50,50]});
      } else if(results.length===1){
        map.setView([results[0][0],results[0][1]],6);
      }
    });
  }
}

function generateCode(trip){
  const name = trip.destination.replace(/\s+/g,'').substring(0,3).toUpperCase();
  const num = Math.floor(1000+Math.random()*9000);
  return name+num;
}

function addTrip(){
  const destination=document.getElementById('destination').value.trim();
  const startDate=document.getElementById('startDate').value;
  const endDate=document.getElementById('endDate').value;
  const transport=document.getElementById('transport').value;
  if(!destination||!startDate||!endDate||!transport){alert('Fill all fields!'); return;}
  trips.push({destination,startDate,endDate,transport});
  renderTrips(); clearForm();
}

function editTrip(index){
  const trip=trips[index];
  document.getElementById('destination').value=trip.destination;
  document.getElementById('startDate').value=trip.startDate;
  document.getElementById('endDate').value=trip.endDate;
  document.getElementById('transport').value=trip.transport;
  trips.splice(index,1); renderTrips();
}

function deleteTrip(index){ trips.splice(index,1); renderTrips(); }

function saveTrips(){ localStorage.setItem('trips',JSON.stringify(trips)); alert('Saved!'); }

function clearForm(){document.getElementById('destination').value='';document.getElementById('startDate').value='';document.getElementById('endDate').value='';document.getElementById('transport').value='';}

// --- MAP ---
function initMap(){
  map=L.map('map').setView([20,0],2);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'¬© OpenStreetMap contributors'}).addTo(map);
  renderTrips();
}

function showOnMap(index){
  const trip=trips[index];
  fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(trip.destination)}`)
  .then(res=>res.json())
  .then(data=>{
    if(data.length>0){
      const {lat,lon}=data[0];
      map.setView([lat,lon],6);
      const marker=L.marker([lat,lon]).addTo(map).bindPopup(`
        <b>${trip.destination}</b><br>
        ${trip.startDate} - ${trip.endDate}<br>
        Transport: ${trip.transport}<br>
        Share Code: <b>${generateCode(trip)}</b>
      `).openPopup();
      markers.push(marker);
    } else { alert('Location not found!'); }
  });
}

// --- IMPORT BY SHARE CODE ---
function importByCode(code){
  const saved = JSON.parse(localStorage.getItem('trips'))||[];
  const trip = saved.find(t=>generateCode(t)===code);
  if(trip){ trips.push(trip); renderTrips(); alert('Imported!'); }
  else alert('Invalid code!');
}

renderTrips();
</script>
</body>
</html>
